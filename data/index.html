<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <title>Firewall Blocked Port Scanner</title>
		<script src="jquery-3.1.1.min.js"></script>
    <script src="script.js"></script>
    <script>
    function scan() {
			var startPort = parseInt($("#advanced-start-port").val());
			var endPort = parseInt($("#advanced-end-port").val())
			var conns = parseInt($("#advanced-conns").val());

			var ports = [];
			for (var i = startPort; i <= endPort; i++) {
				ports.push(i);
			}

			hostname = "{{.Hostname}}";
			apiport = {{.Apiport}};

			nowScanning();
      Webscan(hostname, conns, apiport, ports, onSuccess, onFailure);
    }

		function onSuccess(badPorts) {
			var status = $("#status");
			status.empty();
			status.append($('<p class="success-header">Your blocked ports are:</p>'));
			badPorts.forEach(function (port) {
				status.append('<p>' + port + '</p>');
			});
		}

		function onFailure(error) {
			console.log(error)
			var status = $("#status");
			status.empty();
			status.append($('<p class="error">' + error + '</p>'));
		}

		function nowScanning() {
			var status = $("#status");
			status.empty();
			status.append($('<p class="progress">Scanning...</p>'));
		}

		function showAdvanced() {
			$(".if-advanced").addClass("advanced");
			$(".if-basic").removeClass("basic");
		}

		function hideAdvanced() {
			$(".if-basic").addClass("basic");
			$(".if-advanced").removeClass("advanced");
		}

		function reset() {
			$("#advanced-start-port").val(1);
			$("#advanced-end-port").val(65535);
			$("#advanced-conns").val(50);
		}
    </script>
    <style>{{.Css}}</style>
  </head>
  <body>
    <h1>Firewall Blocked Port Scanner</h1>
		<input type="button" value="Show advanced options" class="basic if-basic" onclick="showAdvanced()"
		<div id="advanced">
			<label class="if-advanced">
				Start port
				<input type="number" id="advanced-start-port" class="if-advanced" placeholder="Start port" value="1"/>
			</label>
			<label class="if-advanced">
				End port
				<input type="number" id="advanced-end-port" class="if-advanced" placeholder="End port" value="65535"/>
			</label>
			<label class="if-advanced">
				Simultaneous connections
				<input type="number" id="advanced-conns" class="if-advanced" placeholder="Simultaneous connections" value="50"/>
			</label>
			<input type="button" id="advanced-reset" class="if-advanced" value="Reset to defaults" onclick="reset()"/>
			<input type="button" value="Hide advanced options" class="if-advanced" onclick="hideAdvanced()"/>
		</div>
		<input type="button" value="Scan Now" onclick="scan()"/>
		<input type="button" value="Cancel" id="cancel-button" class="if-running"/>
		<div id="status"></div>
  </body>
</html>
